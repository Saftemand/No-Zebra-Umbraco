tinymce.PluginManager.add("image",function(n){function u(n,t){function u(n,r){i.parentNode&&i.parentNode.removeChild(i);t({width:n,height:r})}var i=document.createElement("img"),r;i.onload=function(){u(i.clientWidth,i.clientHeight)};i.onerror=function(){u()};r=i.style;r.visibility="hidden";r.position="fixed";r.bottom=r.left=0;r.width=r.height="auto";document.body.appendChild(i);i.src=n}function r(n,t,i){function r(n,i){return i=i||[],tinymce.each(n,function(n){var u={text:n.text||n.title};n.menu?u.menu=r(n.menu):(u.value=n.value,t(u));i.push(u)}),i}return r(n,i||[])}function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):typeof i=="function"?i(t):t(i)}}function i(t){function y(){var i,r,n,t;(i=e.find("#width")[0],r=e.find("#height")[0],i&&r)&&(n=i.value(),t=r.value(),e.find("#constrain")[0].checked()&&s&&h&&n&&t&&(s!=n?(t=Math.round(n/s*t),isNaN(t)||r.value(t)):(n=Math.round(t/h*n),isNaN(n)||i.value(n))),s=n,h=t)}function w(){function t(t){function r(){t.onload=t.onerror=null;n.selection&&(n.selection.select(t),n.nodeChanged())}t.onload=function(){i.width||i.height||!v||o.setAttribs(t,{width:t.clientWidth,height:t.clientHeight});r()};t.onerror=r}k();y();i=tinymce.extend(i,e.toJSON());i.alt||(i.alt="");i.title||(i.title="");i.width===""&&(i.width=null);i.height===""&&(i.height=null);i.style||(i.style=null);i={src:i.src,alt:i.alt,title:i.title,width:i.width,height:i.height,style:i.style,"class":i["class"]};n.undoManager.transact(function(){if(!i.src){f&&(o.remove(f),n.focus(),n.nodeChanged());return}i.title===""&&(i.title=null);f?o.setAttribs(f,i):(i.id="__mcenew",n.focus(),n.selection.setContent(o.createHTML("img",i)),f=o.get("__mcenew"),o.setAttrib(f,"id",null));t(f)})}function l(n){return n&&(n=n.replace(/px$/,"")),n}function d(t){var i,r,o,f=t.meta||{};a&&a.value(n.convertURL(this.value(),"src"));tinymce.each(f,function(n,t){e.find("#"+t).value(n)});f.width||f.height||(i=n.convertURL(this.value(),"src"),r=n.settings.image_prepend_url,o=new RegExp("^(?:[a-z]+:)?//","i"),r&&!o.test(i)&&i.substring(0,r.length)!==r&&(i=r+i),this.value(i),u(n.documentBaseURI.toAbsolute(this.value()),function(n){n.width&&n.height&&v&&(s=n.width,h=n.height,e.find("#width").value(s),e.find("#height").value(h))}))}function b(n){if(n.margin){var t=n.margin.split(" ");switch(t.length){case 1:n["margin-top"]=n["margin-top"]||t[0];n["margin-right"]=n["margin-right"]||t[0];n["margin-bottom"]=n["margin-bottom"]||t[0];n["margin-left"]=n["margin-left"]||t[0];break;case 2:n["margin-top"]=n["margin-top"]||t[0];n["margin-right"]=n["margin-right"]||t[1];n["margin-bottom"]=n["margin-bottom"]||t[0];n["margin-left"]=n["margin-left"]||t[1];break;case 3:n["margin-top"]=n["margin-top"]||t[0];n["margin-right"]=n["margin-right"]||t[1];n["margin-bottom"]=n["margin-bottom"]||t[2];n["margin-left"]=n["margin-left"]||t[1];break;case 4:n["margin-top"]=n["margin-top"]||t[0];n["margin-right"]=n["margin-right"]||t[1];n["margin-bottom"]=n["margin-bottom"]||t[2];n["margin-left"]=n["margin-left"]||t[3]}delete n.margin}return n}function k(){function r(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}if(n.settings.image_advtab){var i=e.toJSON(),t=o.parseStyle(i.style);t=b(t);i.vspace&&(t["margin-top"]=t["margin-bottom"]=r(i.vspace));i.hspace&&(t["margin-left"]=t["margin-right"]=r(i.hspace));i.border&&(t["border-width"]=r(i.border));e.find("#style").value(o.serializeStyle(o.parseStyle(o.serializeStyle(t))))}}function g(){if(n.settings.image_advtab){var i=e.toJSON(),t=o.parseStyle(i.style);e.find("#vspace").value("");e.find("#hspace").value("");t=b(t);(t["margin-top"]&&t["margin-bottom"]||t["margin-right"]&&t["margin-left"])&&(t["margin-top"]===t["margin-bottom"]?e.find("#vspace").value(l(t["margin-top"])):e.find("#vspace").value(""),t["margin-right"]===t["margin-left"]?e.find("#hspace").value(l(t["margin-right"])):e.find("#hspace").value(""));t["border-width"]&&e.find("#border").value(l(t["border-width"]));e.find("#style").value(o.serializeStyle(o.parseStyle(o.serializeStyle(t))))}}var e,i={},o=n.dom,f=n.selection.getNode(),s,h,a,p,v=n.settings.image_dimensions!==!1,c;s=o.getAttrib(f,"width");h=o.getAttrib(f,"height");f.nodeName!="IMG"||f.getAttribute("data-mce-object")||f.getAttribute("data-mce-placeholder")?f=null:i={src:o.getAttrib(f,"src"),alt:o.getAttrib(f,"alt"),title:o.getAttrib(f,"title"),"class":o.getAttrib(f,"class"),width:s,height:h};t&&(a={type:"listbox",label:"Image list",values:r(t,function(t){t.value=n.convertURL(t.value||t.url,"src")},[{text:"None",value:""}]),value:i.src&&n.convertURL(i.src,"src"),onselect:function(n){var t=e.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());e.find("#src").value(n.control.value()).fire("change")},onPostRender:function(){a=this}});n.settings.image_class_list&&(p={name:"class",type:"listbox",label:"Class",values:r(n.settings.image_class_list,function(t){t.value&&(t.textStyle=function(){return n.formatter.getCssText({inline:"img",classes:[t.value]})})})});c=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:d},a];n.settings.image_description!==!1&&c.push({name:"alt",type:"textbox",label:"Image description"});n.settings.image_title&&c.push({name:"title",type:"textbox",label:"Image Title"});v&&c.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:y,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:y,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]});c.push(p);n.settings.image_advtab?(f&&(f.style.marginLeft&&f.style.marginRight&&f.style.marginLeft===f.style.marginRight&&(i.hspace=l(f.style.marginLeft)),f.style.marginTop&&f.style.marginBottom&&f.style.marginTop===f.style.marginBottom&&(i.vspace=l(f.style.marginTop)),f.style.borderWidth&&(i.border=l(f.style.borderWidth)),i.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(f,"style")))),e=n.windowManager.open({title:"Insert/edit image",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:c},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:g},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:k},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:w})):e=n.windowManager.open({title:"Insert/edit image",data:i,body:c,onSubmit:w})}n.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:t(i),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"});n.addMenuItem("image",{icon:"image",text:"Insert/edit image",onclick:t(i),context:"insert",prependToContext:!0});n.addCommand("mceImage",t(i))});
//# sourceMappingURL=plugin.min.js.map
